<!DOCTYPE html>
<html ng-app="TagBBS" ng-controller="MainCtrl">
<meta charset="utf-8">
<title ng-bind="name"></title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!-- Use CDN as much as possible to make repo slimmer-->
<!-- CSS Framework -->
<link rel="stylesheet" type="text/css" href="//netdna.bootstrapcdn.com/bootstrap/3.0.3/css/bootstrap.min.css">
<!-- Angular -->
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular.min.js"></script>
<script src="//ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular-route.min.js"></script>
<!-- Markdown Renderer -->
<script src="//cdnjs.cloudflare.com/ajax/libs/showdown/0.3.1/showdown.min.js"></script>
<!-- YAML -->
<script src="http://nodeca.github.io/js-yaml/js/js-yaml.js"></script>
<!-- Post Editor -->
<link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/codemirror.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/codemirror.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/3.21.0/mode/markdown/markdown.min.js"></script>
<!-- Progress Bar, should replace with a trusted CDN -->
<link rel="stylesheet" type="text/css" href="http://labs.voronianski.com/ngprogress-lite.js/ngprogress-lite.css">
<script src="http://labs.voronianski.com/ngprogress-lite.js/ngprogress-lite.min.js"></script>
<!-- TagBBS -->
<link rel="stylesheet" type="text/css" href="tagbbs.css">
<script src="tagbbs.js"></script>

<body>
<aside>
    <ul class="nav">
        <li><h1 title="server build: {{version}}"><span class="glyphicon glyphicon-home"></span> {{name}}</h1></li>
        <li><a href="#/list"><span class="glyphicon glyphicon-th-list"></span> List</a></li>
        <li><a href="#/put"><span class="glyphicon glyphicon-file"></span> Put</a></li>
        <li>&nbsp;</li>
        <li ng-hide="user"><a href="#/login"><span class="glyphicon glyphicon-log-in"></span> Login</a></li>
        <li ng-hide="user"><a href="#/register"> Register</a></li>
        <li ng-show="user"><a href="#/show/user:{{user}}" title="my profile"><span class="glyphicon glyphicon-user"></span> {{user}}</a>
        <li ng-show="user"><a href="#/logout"><span class="glyphicon glyphicon-log-out"></span> Logout</a></li>
    </ul>
</aside>
<div class="container">
    <div ng-view></div>
</div>

<script type="text/ng-template" id="login.html">
<form role="form" ng-submit="submit()" class="login">
    <div class="alert alert-danger" ng-show="message">{{message}}</div>
    <div class="form-group">
    <label>User</label>
    <input type="text" class="form-control" placeholder="user id" ng-model="user">
    </div>
    <div class="form-group">
    <label>Password</label>
    <input type="password" class="form-control" placeholder="password" ng-model="pass">
    </div>
    <button type="submit" class="btn btn-default">Login</button>
</form>
</script>

<script type="text/ng-template" id="register.html">
Not yet implemented. Please use SSH instead.
</script>

<script type="text/ng-template" id="logout.html">
<div>{{error}}</div>
</script>

<script type="text/ng-template" id="list.html">
<form ng-submit="newQuery()">
<input class="query-input" type="text" ng-model="query" placeholder="all">
</form>
<ul class="posts-listing">
    <li ng-repeat="post in posts">
        <a href="#show/{{post.key}}">
            <span class="post-key">{{post.key}}</span><span class="post-title">{{post.title}}</span>
        </a>
        <a class="post-author" href="#/show/user:{{post.authors.0}}">{{post.authors.0}}</a>
        <a class="post-tag" ng-repeat="tag in post.tags" href="#/list/{{tag}}">{{tag}}</a>
    </li>
</ul>
</script>

<script type="text/ng-template" id="show.html">
<div class="alert alert-danger" ng-if="error">{{error}}</div>
<post ng-model="post" ng-if="post.rev"></post>
<div class="alert alert-warning" ng-hide="post.rev || loading"> No Content </div>
<hr>
<a class="btn btn-primary" href="#/put/{{key}}" title="Edit"><span class="glyphicon glyphicon-edit"></span> Edit</a>
<button class="btn btn-default" ng-click="show_raw()" ng-if="post.rev" title="Show Raw"><span class="glyphicon glyphicon-new-window"></span> Source</button>
</script>

<script type="text/ng-template" id="put.html">
<div class="alert alert-danger" ng-if="error">{{error}}</div>
<form ng-submit="submit()">
    <input class="query-input" type="text" ng-model="key" placeholder="new post"><br>
    <textarea class="form-control" rows="15" codemirror ng-model="content"></textarea> <br>
    <button class="btn btn-primary" type="submit"><span class="glyphicon glyphicon-floppy-disk"></span> Commit</button>
    <span ng-show="rev">rev: {{rev}}</span><br>
</form>
</script>

<script type="text/ng-template" id="post.html">
<h1>{{title}}</h1>
<div>{{timestamp}}, {{key}} rev {{rev}}</div>
<span ng-show="tags">in: <span ng-repeat="tag in tags"><a href="#/list/{{tag}}">{{tag}}</a> </span></span>
<span ng-show="authors">by: <span ng-repeat="author in authors"><a href="#/show/user:{{author}}">{{author}}</a> </span></span>
<hr>
<div ng-bind-html="body" ng-if="body" class="post-body"></div>
<pre ng-bind="source" ng-if="!body" class="post-source"></pre>
</script>

</body>
</html>
